{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{Form,Button,Container}from'react-bootstrap';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UnsubscriptionForm=()=>{const[userId,setUserId]=useState('');const[fundId,setFundId]=useState('');const[clients,setClients]=useState([]);const[clientsWithTransactions,setClientsWithTransactions]=useState([]);const[clientFunds,setClientFunds]=useState([]);const[funds,setFunds]=useState([]);useEffect(()=>{const fetchClients=async()=>{try{const response=await axios.get('http://localhost:5000/clients');setClients(response.data);}catch(error){console.error('Error fetching clients:',error);}};const fetchFunds=async()=>{try{const response=await axios.get('http://localhost:5000/funds');setFunds(response.data);}catch(error){console.error('Error fetching funds:',error);}};const fetchClientsWithTransactions=async()=>{try{const response=await axios.get('http://localhost:5000/all_transactions');const uniqueClientIds=[...new Set(response.data.map(txn=>txn.ClientID))];setClientsWithTransactions(uniqueClientIds);}catch(error){console.error('Error fetching clients with transactions:',error);}};fetchClients();fetchFunds();fetchClientsWithTransactions();},[]);const fetchClientFunds=async clientId=>{try{const response=await axios.get(\"http://localhost:5000/client_funds?client_id=\".concat(clientId));setClientFunds(response.data);}catch(error){console.error('Error fetching client funds:',error);}};const handleClientChange=e=>{const clientId=e.target.value;setUserId(clientId);fetchClientFunds(clientId);};const unsubscribe=async()=>{try{const response=await axios.post('http://localhost:5000/unsubscribe',{client_id:userId,fund_id:fundId});alert(\"Cancelaci\\xF3n exitosa: \".concat(response.data.transaction_id));setClientFunds(clientFunds.filter(fund=>fund.FundID!==fundId));setFundId('');}catch(error){alert(error.response.data.message);}};const getFundName=fundId=>{const fund=funds.find(f=>f.Id===fundId);return fund?fund.Nombre:'Desconocido';};return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Cancelar Suscripci\\xF3n de un Fondo\"}),/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Cliente\"}),/*#__PURE__*/_jsxs(Form.Control,{as:\"select\",value:userId,onChange:handleClientChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un cliente\"}),clients.filter(client=>clientsWithTransactions.includes(client.ClienteId)).map(client=>/*#__PURE__*/_jsx(\"option\",{value:client.ClienteId,children:client.Name},client.ClienteId))]})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Fondo\"}),/*#__PURE__*/_jsxs(Form.Control,{as:\"select\",value:fundId,onChange:e=>setFundId(e.target.value),disabled:!userId,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un fondo\"}),clientFunds.map(fund=>/*#__PURE__*/_jsx(\"option\",{value:fund.FundID,children:getFundName(fund.FundID)},fund.FundID))]})]}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:unsubscribe,disabled:!fundId,children:\"Cancelar Suscripci\\xF3n\"})]})]});};export default UnsubscriptionForm;","map":{"version":3,"names":["React","useState","useEffect","axios","Form","Button","Container","jsx","_jsx","jsxs","_jsxs","UnsubscriptionForm","userId","setUserId","fundId","setFundId","clients","setClients","clientsWithTransactions","setClientsWithTransactions","clientFunds","setClientFunds","funds","setFunds","fetchClients","response","get","data","error","console","fetchFunds","fetchClientsWithTransactions","uniqueClientIds","Set","map","txn","ClientID","fetchClientFunds","clientId","concat","handleClientChange","e","target","value","unsubscribe","post","client_id","fund_id","alert","transaction_id","filter","fund","FundID","message","getFundName","find","f","Id","Nombre","children","Group","Label","Control","as","onChange","client","includes","ClienteId","Name","disabled","variant","onClick"],"sources":["C:/Users/guiog/Documents/amaris/fund_app/frontend/src/components/UnsubscriptionForm.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { Form, Button, Container } from 'react-bootstrap';\r\n\r\nconst UnsubscriptionForm = () => {\r\n  const [userId, setUserId] = useState('');\r\n  const [fundId, setFundId] = useState('');\r\n  const [clients, setClients] = useState([]);\r\n  const [clientsWithTransactions, setClientsWithTransactions] = useState([]);\r\n  const [clientFunds, setClientFunds] = useState([]);\r\n  const [funds, setFunds] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const fetchClients = async () => {\r\n      try {\r\n        const response = await axios.get('http://localhost:5000/clients');\r\n        setClients(response.data);\r\n      } catch (error) {\r\n        console.error('Error fetching clients:', error);\r\n      }\r\n    };\r\n\r\n    const fetchFunds = async () => {\r\n      try {\r\n        const response = await axios.get('http://localhost:5000/funds');\r\n        setFunds(response.data);\r\n      } catch (error) {\r\n        console.error('Error fetching funds:', error);\r\n      }\r\n    };\r\n\r\n    const fetchClientsWithTransactions = async () => {\r\n      try {\r\n        const response = await axios.get('http://localhost:5000/all_transactions');\r\n        const uniqueClientIds = [...new Set(response.data.map(txn => txn.ClientID))];\r\n        setClientsWithTransactions(uniqueClientIds);\r\n      } catch (error) {\r\n        console.error('Error fetching clients with transactions:', error);\r\n      }\r\n    };\r\n\r\n    fetchClients();\r\n    fetchFunds();\r\n    fetchClientsWithTransactions();\r\n  }, []);\r\n\r\n  const fetchClientFunds = async (clientId) => {\r\n    try {\r\n      const response = await axios.get(`http://localhost:5000/client_funds?client_id=${clientId}`);\r\n      setClientFunds(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching client funds:', error);\r\n    }\r\n  };\r\n\r\n  const handleClientChange = (e) => {\r\n    const clientId = e.target.value;\r\n    setUserId(clientId);\r\n    fetchClientFunds(clientId);\r\n  };\r\n\r\n  const unsubscribe = async () => {\r\n    try {\r\n      const response = await axios.post('http://localhost:5000/unsubscribe', { client_id: userId, fund_id: fundId });\r\n      alert(`Cancelación exitosa: ${response.data.transaction_id}`);\r\n      setClientFunds(clientFunds.filter(fund => fund.FundID !== fundId));\r\n      setFundId('');\r\n    } catch (error) {\r\n      alert(error.response.data.message);\r\n    }\r\n  };\r\n\r\n  const getFundName = (fundId) => {\r\n    const fund = funds.find(f => f.Id === fundId);\r\n    return fund ? fund.Nombre : 'Desconocido';\r\n  };\r\n\r\n  return (\r\n    <Container>\r\n      <h2>Cancelar Suscripción de un Fondo</h2>\r\n      <Form>\r\n        <Form.Group>\r\n          <Form.Label>Cliente</Form.Label>\r\n          <Form.Control as=\"select\" value={userId} onChange={handleClientChange}>\r\n            <option value=\"\">Seleccione un cliente</option>\r\n            {clients\r\n              .filter(client => clientsWithTransactions.includes(client.ClienteId))\r\n              .map((client) => (\r\n                <option key={client.ClienteId} value={client.ClienteId}>{client.Name}</option>\r\n              ))}\r\n          </Form.Control>\r\n        </Form.Group>\r\n        <Form.Group>\r\n          <Form.Label>Fondo</Form.Label>\r\n          <Form.Control as=\"select\" value={fundId} onChange={(e) => setFundId(e.target.value)} disabled={!userId}>\r\n            <option value=\"\">Seleccione un fondo</option>\r\n            {clientFunds.map((fund) => (\r\n              <option key={fund.FundID} value={fund.FundID}>{getFundName(fund.FundID)}</option>\r\n            ))}\r\n          </Form.Control>\r\n        </Form.Group>\r\n        <Button variant=\"danger\" onClick={unsubscribe} disabled={!fundId}>Cancelar Suscripción</Button>\r\n      </Form>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default UnsubscriptionForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}